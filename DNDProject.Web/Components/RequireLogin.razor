@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider Auth
@inject NavigationManager Nav

@ChildContent

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        var path = new Uri(Nav.Uri).AbsolutePath;

        // /login er public
        if (path.Equals("/login", StringComparison.OrdinalIgnoreCase))
            return;

        var state = await Auth.GetAuthenticationStateAsync();
        if (!(state.User?.Identity?.IsAuthenticated ?? false))
            Nav.NavigateTo("/login", replace: true);
    }
}
